let gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];function slide(e,t){let r;for(r="up"==t||"down"==t?[gameBoard[0][e],gameBoard[1][e],gameBoard[2][e],gameBoard[3][e]].filter(e=>0!=e):gameBoard[e].filter(e=>0!=e),("right"==t||"down"==t)&&r.reverse(),i=0;i<r.length;i++){let o=0==i?3:1==i?2:2==i?1:null,a;"left"==t?a=document.getElementById(`${e}-${i}`):"right"==t?a=document.getElementById(`${e}-${o}`):"up"==t?a=document.getElementById(`${i}-${e}`):"down"==t&&(a=document.getElementById(`${o}-${e}`)),r[i]==r[i+1]&&(r[i]*=2,r[i+1]=0,score.currentScore+=r[i],a.classList.remove("pop-up"),setTimeout(()=>{a.classList.add("pop-up")},200),displayScore())}let s=r.filter(e=>0!=e);if(s.push(0),s.push(0),s.push(0),s.push(0),"left"==t)return s.splice(0,4);if("right"==t)return s.splice(0,4).reverse();if("up"==t){let n=s.splice(0,4);for(let l=0;l<n.length;l++)gameBoard[l][e]=n[l]}else if("down"==t){let c=s.splice(0,4).reverse();for(let d=3;d>=0;d--)gameBoard[d][e]=c[d]}}function setTwoOrFour(){let e=Math.floor(4*Math.random()),t=Math.floor(4*Math.random()),r=`${e}-${t}`;if(!isGameBoardFull()){if(Math.floor(100*Math.random())>=80){if(0===gameBoard[e][t]){let o=document.getElementById(r);o.textContent="4",o.classList.remove("pop-up"),gameBoard[e][t]=4}else setTwoOrFour()}else{if(0===gameBoard[e][t]){let a=document.getElementById(r);a.textContent="2",a.classList.remove("pop-up"),gameBoard[e][t]=2}else setTwoOrFour();tileUpdate()}}}function tileUpdate(){for(let e=0;e<gameBoard.length;e++)for(let t=0;t<gameBoard[e].length;t++){let r=document.getElementById(`${e}-${t}`);r.innerText=gameBoard[e][t];let o=r.innerText;r.classList.value=`_tile t${o}`,parseInt(o)>=8192&&(r.classList.value="_tile t8192-or-more"),r.classList.remove("pop-up"),r.classList.add("pop-up"),0==o&&(r.innerText="")}}function checkIfWin(){for(let e=0;e<gameBoard.length;e++)if(gameBoard[e].includes(2048)){document.querySelector("h3").innerText="You win!";return}}function isGameBoardFull(){if(!gameBoard[0].includes(0)&&!gameBoard[1].includes(0)&&!gameBoard[2].includes(0)&&!gameBoard[3].includes(0))return!0}function resetGame(){gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],document.querySelector("h3").innerText="",score.currentScore=0,displayScore(),setTwoOrFour(),setTwoOrFour(),tileUpdate(),saveGameData()}document.addEventListener("keyup",e=>{"ArrowLeft"==e.code||"KeyA"==e.code?(gameBoard=[slide(0,"left"),slide(1,"left"),slide(2,"left"),slide(3,"left")],setTwoOrFour(),saveGameData(),checkIfWin()):"ArrowRight"==e.code||"KeyD"==e.code?(gameBoard=[slide(0,"right"),slide(1,"right"),slide(2,"right"),slide(3,"right")],setTwoOrFour(),saveGameData(),checkIfWin()):"ArrowUp"==e.code||"KeyW"==e.code?(slide(0,"up"),slide(1,"up"),slide(2,"up"),slide(3,"up"),setTwoOrFour(),saveGameData(),checkIfWin()):("ArrowDown"==e.code||"KeyS"==e.code)&&(slide(0,"down"),slide(1,"down"),slide(2,"down"),slide(3,"down"),setTwoOrFour(),saveGameData(),checkIfWin()),tileUpdate()});let resetButton=document.querySelector(".__reset button");resetButton.addEventListener("click",resetGame);let score={currentScore:0,bestScore:0},currentScoreDiv=document.querySelector("._current"),bestScoreDiv=document.querySelector("._best");function displayScore(){currentScoreDiv.innerText=score.currentScore,setBestScore()}function setBestScore(){score.currentScore>score.bestScore&&(score.bestScore=score.currentScore,bestScoreDiv.innerText=`(${score.bestScore})`)}const storageKey1="Game_Score",storageKey2="Game_Progress";function saveGameData(){let e=JSON.stringify(score);localStorage.setItem(storageKey1,e);let t=JSON.stringify(gameBoard);localStorage.setItem(storageKey2,t)}function loadGameData(){let e=JSON.parse(localStorage.getItem(storageKey1)),t=JSON.parse(localStorage.getItem(storageKey2));null!==e&&null!==t&&(0==e.currentScore?gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]:(gameBoard=t,checkIfWin()),score.currentScore=e.currentScore,score.bestScore=e.bestScore,bestScoreDiv.innerText=`(${e.bestScore})`,currentScoreDiv.innerText=e.currentScore)}document.addEventListener("DOMContentLoaded",()=>{loadGameData(),0==score.currentScore&&(setTwoOrFour(),setTwoOrFour()),tileUpdate()});let gameBoardDiv=document.querySelector(".__gameboard");gameBoardDiv.addEventListener("touchstart",handleTouchStart,!1),gameBoardDiv.addEventListener("touchmove",handleTouchMove,!1);var xDown=null,yDown=null;function getTouches(e){return e.touches}function handleTouchStart(e){let t=getTouches(e)[0];xDown=t.clientX,yDown=t.clientY}function handleTouchMove(e){if(xDown&&yDown){var t=e.touches[0].clientX,r=e.touches[0].clientY,o=xDown-t,a=yDown-r;Math.abs(o)>Math.abs(a)?o>0?(gameBoard=[slide(0,"left"),slide(1,"left"),slide(2,"left"),slide(3,"left")],setTwoOrFour(),saveGameData(),checkIfWin()):(gameBoard=[slide(0,"right"),slide(1,"right"),slide(2,"right"),slide(3,"right")],setTwoOrFour(),saveGameData(),checkIfWin()):(a>0?(slide(0,"up"),slide(1,"up"),slide(2,"up"),slide(3,"up"),setTwoOrFour(),saveGameData(),checkIfWin()):(slide(0,"down"),slide(1,"down"),slide(2,"down"),slide(3,"down"),setTwoOrFour(),saveGameData(),checkIfWin()),tileUpdate()),xDown=null,yDown=null}}