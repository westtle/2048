let score={currentScore:0,bestScore:0},gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];const gameBoardHTML=document.querySelector(".__gameboard"),currentScoreHTML=document.querySelector("._current"),bestScoreHTML=document.querySelector("._best"),resetButton=document.querySelector(".__reset button");function slide(e,r){let o;for(o="up"==r||"down"==r?[gameBoard[0][e],gameBoard[1][e],gameBoard[2][e],gameBoard[3][e]].filter(e=>0!=e):gameBoard[e].filter(e=>0!=e),("right"==r||"down"==r)&&o.reverse(),i=0;i<o.length;i++){let t=0==i?3:1==i?2:2==i?1:null,a;"left"==r?a=document.getElementById(`${e}-${i}`):"right"==r?a=document.getElementById(`${e}-${t}`):"up"==r?a=document.getElementById(`${i}-${e}`):"down"==r&&(a=document.getElementById(`${t}-${e}`)),o[i]==o[i+1]&&(o[i]*=2,o[i+1]=0,score.currentScore+=o[i],a.classList.remove("pop-up_"),setTimeout(()=>{a.classList.add("pop-up_")},200),displayScore())}let s=o.filter(e=>0!=e);if(s.push(0),s.push(0),s.push(0),s.push(0),"left"==r)return s.splice(0,4);if("right"==r)return s.splice(0,4).reverse();if("up"==r){let n=s.splice(0,4);for(let l=0;l<n.length;l++)gameBoard[l][e]=n[l]}else if("down"==r){let c=s.splice(0,4).reverse();for(let d=3;d>=0;d--)gameBoard[d][e]=c[d]}}function spawnTwoOrFour(){let e=Math.floor(4*Math.random()),r=Math.floor(4*Math.random()),o=`${e}-${r}`;if(!isGameBoardFull()){if(0==gameBoard[e][r]){let t=document.getElementById(o);t.classList.remove("pop-up_"),Math.floor(100*Math.random())>=80?(t.textContent="4",gameBoard[e][r]=4):(t.textContent="2",gameBoard[e][r]=2)}else spawnTwoOrFour();tileUpdate()}}function tileUpdate(){for(let e=0;e<gameBoard.length;e++)for(let r=0;r<gameBoard[e].length;r++){let o=document.getElementById(`${e}-${r}`);o.innerText=gameBoard[e][r];let t=o.innerText;o.classList.value=`_tile t${t}`,parseInt(t)>=8192&&(o.classList.value="_tile t8192-or-above"),o.classList.remove("pop-up_"),o.classList.add("pop-up_"),0==t&&(o.innerText="")}}function resetGame(){gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],document.querySelector("._win").style.display="none",score.currentScore=0,displayScore(),spawnTwoOrFour(),spawnTwoOrFour(),tileUpdate(),saveGameData()}function displayScore(){currentScoreHTML.innerText=score.currentScore,setBestScore()}function setBestScore(){score.currentScore>score.bestScore&&(score.bestScore=score.currentScore,bestScoreHTML.innerText=`(${score.bestScore})`)}function checkIfWin(){gameBoard.forEach((e,r)=>{if(gameBoard[r].includes(2048)){document.querySelector("._win").style.display="inline-block";return}})}function isGameBoardFull(){if(!gameBoard[0].includes(0)&&!gameBoard[1].includes(0)&&!gameBoard[2].includes(0)&&!gameBoard[3].includes(0))return!0}const game_score="Game_Score",game_progress="Game_Progress";function saveGameData(){localStorage.setItem(game_score,JSON.stringify(score)),localStorage.setItem(game_progress,JSON.stringify(gameBoard))}function loadGameData(){let e=JSON.parse(localStorage.getItem(game_score)),r=JSON.parse(localStorage.getItem(game_progress));null!=e&&null!=r&&(0==e.currentScore?gameBoard=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]:(gameBoard=r,checkIfWin()),score.currentScore=e.currentScore,score.bestScore=e.bestScore,bestScoreHTML.innerText=`(${e.bestScore})`,currentScoreHTML.innerText=e.currentScore)}var xDown=null,yDown=null;function getTouches(e){return e.touches}function handleTouchStart(e){let r=getTouches(e)[0];xDown=r.clientX,yDown=r.clientY}function handleTouchMove(e){if(xDown&&yDown){var r=e.touches[0].clientX,o=e.touches[0].clientY,t=xDown-r,a=yDown-o;Math.abs(t)>Math.abs(a)?t>0?(gameBoard=[slide(0,"left"),slide(1,"left"),slide(2,"left"),slide(3,"left")],spawnTwoOrFour(),saveGameData(),checkIfWin()):(gameBoard=[slide(0,"right"),slide(1,"right"),slide(2,"right"),slide(3,"right")],spawnTwoOrFour(),saveGameData(),checkIfWin()):(a>0?(slide(0,"up"),slide(1,"up"),slide(2,"up"),slide(3,"up"),spawnTwoOrFour(),saveGameData(),checkIfWin()):(slide(0,"down"),slide(1,"down"),slide(2,"down"),slide(3,"down"),spawnTwoOrFour(),saveGameData(),checkIfWin()),tileUpdate()),xDown=null,yDown=null}}gameBoardHTML.addEventListener("touchstart",handleTouchStart,{passive:!0}),gameBoardHTML.addEventListener("touchmove",handleTouchMove,{passive:!0}),resetButton.addEventListener("click",resetGame),document.addEventListener("keyup",e=>{"ArrowLeft"==e.code||"KeyA"==e.code?(gameBoard=[slide(0,"left"),slide(1,"left"),slide(2,"left"),slide(3,"left")],spawnTwoOrFour(),saveGameData(),checkIfWin()):"ArrowRight"==e.code||"KeyD"==e.code?(gameBoard=[slide(0,"right"),slide(1,"right"),slide(2,"right"),slide(3,"right")],spawnTwoOrFour(),saveGameData(),checkIfWin()):"ArrowUp"==e.code||"KeyW"==e.code?(slide(0,"up"),slide(1,"up"),slide(2,"up"),slide(3,"up"),spawnTwoOrFour(),saveGameData(),checkIfWin()):("ArrowDown"==e.code||"KeyS"==e.code)&&(slide(0,"down"),slide(1,"down"),slide(2,"down"),slide(3,"down"),spawnTwoOrFour(),saveGameData(),checkIfWin()),tileUpdate()}),document.addEventListener("DOMContentLoaded",()=>{loadGameData(),0==score.currentScore&&(spawnTwoOrFour(),spawnTwoOrFour()),tileUpdate()});